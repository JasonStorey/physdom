<!DOCTYPE html>
<html>
  <head>
    <title>cannon.js - bounce demo</title>
    <meta charset="utf-8">
    <style type="text/css">
        html, body {
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
            perspective: 1000px;
        }
        .plane-body {
            background-color: blue;
            width: 100px;
            height: 100px;
        }
    </style>
  </head>
  <body>
    <div id="test" class="plane-body"></div>
    <script src="./lib/Oimo.min.js"></script>
    <script>

        function Body() {
            this.el = document.getElementById('test');
            this.width = this.el.offsetWidth;
            this.height = this.el.offsetHeight;
            this.shape = new OIMO.Body({
                type: 'box',
                size: [this.width * 2, this.height * 2, 200],
                pos: [0, 0, 0],
                move: true,
                world: world
            });
        }

        Body.prototype.render = function render() {
            var matrix,
                m;

            if(this.shape.body.sleeping) {
                return;
            }
            
            matrix = this.shape.body.getMatrix();

            // m =[matrix[0], matrix[4], matrix[8],  matrix[12],
            //     matrix[1], matrix[5], matrix[9],  matrix[13],
            //     matrix[2], matrix[6], matrix[10], matrix[14],
            //     matrix[3], matrix[7], matrix[11], matrix[15]];

            m =[matrix[0], matrix[1], matrix[2],  matrix[3],
                matrix[4], matrix[5], matrix[6],  matrix[7],
                matrix[8], matrix[9], matrix[10], matrix[11],
                matrix[12], matrix[13], matrix[14], matrix[15] + 1];

            this.el.style.transform = 'matrix3d(' + m.toString() + ')';
        };

        Body.prototype.applyForce = function applyForce(x,y,z, offsetX, offsetY) {
            var pos = this.shape.body.position.clone();
            pos.x += offsetX;
            pos.y += offsetY;
            var force = new OIMO.Vec3(x, y, z);
            this.shape.body.applyImpulse(pos, force);
        };

        var world = new OIMO.World();
        world.gravity = new OIMO.Vec3(0, 10, 0);
        // var ground = new OIMO.Body({size:[10, 10, 100], pos:[0, 400, 0], world:world});
        var ground2 = new OIMO.Body({size:[10000, 1, 100000], pos:[0, window.document.documentElement.offsetHeight, 0], world:world});
        var body = new Body();
        body.el.addEventListener('click', function(e) {
            var offsetX,
                offsetY;

            offsetX = (e.offsetX / body.width) - 0.5;
            offsetY = (e.offsetY / body.height) - 0.5;
            console.log(offsetX, offsetY);


            body.applyForce(-100 * offsetX, -200 * offsetY, -10, 0, 0);
        });

        function animate(t) {
            body.render();
            world.step();
            window.requestAnimationFrame(animate);
        }
    
        animate(0);
    </script>
  </body>
</html>